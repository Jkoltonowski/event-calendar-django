{% extends 'events/base.html' %}

{% block title %}Widok kalendarza{% endblock %}

{% block content %}
    <form method="GET" action="{% url 'calendar_view' %}" aria-label="Filtruj wydarzenia po tagach" class="mb-4">
        <div class="row justify-content-center">
            <div class="col-md-6">
                <div class="input-group">
                    <label class="input-group-text" for="tag-select">
                        <i class="bi bi-filter"></i> Filtruj poprzez tagi
                    </label>
                    <select class="form-select" id="tag-select" name="tag" aria-label="Filtruj wydarzenia po tagach" onchange="this.form.submit()">
                        <option value="">Wszystkie tagi</option>
                        {% for tag in tags %}
                            <option value="{{ tag }}" {% if selected_tag == tag %}selected{% endif %}>
                                {{ tag }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
            </div>
        </div>
    </form>

    <style>
        .fc-daygrid-event, .fc-timegrid-event {
            background-color: #d8eafc; /* Jasnoniebieskie tło dla każdego wydarzenia */
            color: #004080; /* Ciemnoniebieski tekst */
            border: 1px solid #004080; /* Obramowanie pasujące do koloru tekstu */
            padding: 5px; /* Większe odstępy wewnętrzne */
            border-radius: 4px; /* Delikatne zaokrąglenie rogów */
            margin-bottom: 5px; /* Odstępy między wydarzeniami */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* Lekki cień */
            text-align: center; /* Wycentrowanie tekstu */
            white-space: normal; /* Zezwolenie na łamanie tekstu */
            position: relative; /* Aby tooltip był związany z tym wydarzeniem */
        }

        .fc-event-time {
            font-weight: bold;
            color: #002a5e; /* Wyraźny kolor godzin */
            display: block; /* Wyświetlanie w osobnej linii */
            margin-bottom: 8px; /* Odstęp między godziną a tytułem */
        }

        .fc-event-title {
            font-size: 1rem;
            color: #004080;
            white-space: normal; /* Zezwolenie na zawijanie tekstu */
            display: block; /* Wyświetlanie tytułu w osobnej linii */
            margin-top: 0; /* Brak marginesu na górze */
        }

        .tooltip-kafel {
            position: absolute;
            background-color: #f9f9f9;
            color: #333;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            display: none; /* Ukrycie tooltipa domyślnie */
            max-width: 200px;
            width: 200px; /* Stała szerokość dla kwadratowego wyglądu */
            text-align: left;
            top: -80px; /* Pozycjonowanie tooltipa nad wydarzeniem */
            left: 50%;
            transform: translateX(-50%); /* Wycentrowanie tooltipa względem wydarzenia */
            white-space: normal; /* Zezwolenie na zawijanie tekstu */
            word-wrap: break-word; /* Zawijanie długich słów */
            overflow: hidden; /* Ukrycie nadmiarowego tekstu, jeśli jest zbyt długi */
            max-height: 150px; /* Maksymalna wysokość tooltipa */
            overflow-y: auto; /* Pojawi się przewijanie, jeśli tekst jest zbyt długi */
        }

        .fc-daygrid-event:hover .tooltip-kafel, .fc-timegrid-event:hover .tooltip-kafel {
            display: block; /* Wyświetlanie tooltipa na hover */
        }
    </style>    

    <div id="calendar"></div>

    <!-- Skrypty Bootstrap oraz FullCalendar -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.9.0/main.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.9.0/locales/pl.js"></script>

    <!-- CSS Bootstrap oraz FullCalendar -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.9.0/main.min.css" rel="stylesheet">

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var calendarEl = document.getElementById('calendar');
            var calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',  // Ustaw widok na startowy, np. miesięczny
                locale: 'pl',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek,timeGridDay'
                },
                eventTimeFormat: {
                    hour: '2-digit',
                    minute: '2-digit',
                    meridiem: false
                },
                events: [
                    {% for event in events %}
                    {
                        title: '{{ event.name|escapejs }}',
                        start: '{{ event.start_time }}',
                        url: '{% url "event_detail" event.id %}?view=calendar',
                        description: '{{ event.short_description|escapejs }}'
                    },
                    {% endfor %}
                ],
                eventDidMount: function(info) {
                    // Dodaj tooltip z opisem na hover dla różnych widoków
                    var tooltip = document.createElement('div');
                    tooltip.classList.add('tooltip-kafel');
                    tooltip.innerText = info.event.extendedProps.description;
                    info.el.appendChild(tooltip);
                }
            });

            calendar.render();
        });
    </script>
{% endblock %}
